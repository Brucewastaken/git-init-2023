<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>App Usage Monitor</title>
  <script>
    var interval = 60; //in seconds
    var timeCounter = 30;
    var maxTime = 30;
    var hasGame = false;
    var running = true;
  </script>
</head>
<style>
    h1{
      font-family: Helvetica;  
      font-size: 100px;
      color: white;
      text-align: center;
      outline:invert;
      outline-color: #9e363a;
      margin: 0;
      background-color: #1dbab4;
    }
    h2{
        font-size:36px;
        color: white; 
        background-color: #fc5226;
        margin: 0;
        text-align: center;
    }
    body{
        background-color: #1c77ac;
        min-width: 1000px;
    }
   
    #OnTask{
        position: absolute; 
        top: 50%; left: 50%; 
        transform: translate(-50%, -50%); 
        font-size: 150px; 
        color: #1fd655;
        margin: 0;
    }
    .settings{
        font-size: 29px;
        float: right;
        width: 25%;
        padding: 10px;
        height: 300px;
        background-color: white;
        outline: auto;
        outline-color: aquamarine;
        margin-top: 15px;
    }
    ul{
        list-style: none;
        padding: 5px;
        padding-left: 0;
        list-style-type: none;
        font-size: 30px;
        margin: 0;
    }

    .appUsage {
        float: left;
        width: 12.5%;
        padding: 10px;
        height: 300px;
        margin-top: 15px;
    }

    .timeUsage{
        float: left;
        width: 15%;
        padding: 10px;
        height: 300px;
        margin-top: 15px;
    }

    @media (max-width: 1500px) and (min-width: 1200px) {
        h2 {font-size: 30px}
        #OnTask {font-size: 125px;}
        ul {font-size: 24px;}
        .settings {font-size: 24px;}
    }

    @media (max-width: 1200px) {
        h2 {font-size: 26px}
        #OnTask {font-size: 84px;}
        ul {font-size: 22px;}
        .settings {font-size: 22px;}
    }

    @media (max-width: 1000px) {
        #OnTask {
            font-size: 76px;
            position: absolute;
            top: 425px;
            left: 525px;
        }
        h1 {font-size: 80px}
    }
</style>
<body>
  <h1>App Usage Monitor</h1>

  <h2 id = "time"></h2>
   
    <div class = "appUsage">
        <h2>Apps Used</h2>
        <ul id = "apps">
            <li>Minecraft</li>
            <li>Valorant</li>
        </ul>
    </div>

    <div class = "timeUsage">
        <h2>Time Spent</h2>
        <ul id="time spent">
            <li>20 minutes</li>
            <li>10 minutes</li>
        </ul>
    </div>

    <text id="OnTask">ON TASK</text>

    <div class="settings">
        <label for="work_times">Choose a work time:</label>
            <select style="width: 150px; height: 20px; font-size: 16px">
                <option value=30>30 minutes</option>
                <option value=45>45 minutes</option>
                <option value=60>1 hour</option>
                <option value=90>1 hour 30 minutes</option>
                <option value=120>2 hours</option>

            </select>
    </div>

  <script>
    const { ipcRenderer } = require('electron');

    function requestActiveApps() {
      if (running) {
        ipcRenderer.send('check-background-apps', interval, timeCounter, maxTime);
      }
    }

    ipcRenderer.on('app-list', (event, response) => {
      var apps = document.getElementById('apps');
      var item = document.createElement('li');
      item.textContent = response[0] + "\t\t\t\t\t\t\t\t" + response[1] + "\t\t\t\t\t\t\t\t" + response[3];
      apps.appendChild(item);
    });

    ipcRenderer.on('clear-list', (event) => {
      var apps = document.getElementById('apps');
      apps.innerHTML = "";
    });


    ipcRenderer.on('current-stats', (event, game) => {
      hasGame = game;
    });


    setInterval(() => {
      if (hasGame) {
        timeCounter -= 1;
        console.log(1);
        if (timeCounter == 0) {
          timeCounter = maxTime;
          hasGame = false;
          ipcRenderer.send('time-out');
          running = false;
        } 
      }
      var timeElement = document.getElementById('time');
      timeElement.innerHTML = secondsToMinutesAndSeconds(timeCounter) + "remaining";
    }, 1000);
    
    requestActiveApps();
    setInterval(() => {
      requestActiveApps();
    }, interval*1000);


    function secondsToMinutesAndSeconds(seconds) {
      const minutes = Math.floor(seconds / 60);
      const remainingSeconds = seconds % 60;
      return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
    }
  </script>
</body>
</html>
