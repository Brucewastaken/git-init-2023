<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>App Usage Monitor</title>
  <script>
    var interval = 60; //in seconds
    var timeCounter = 30;
    var maxTime = 30;
    var hasGame = false;
    var running = true;
  </script>
</head>
<body>
  <h1>App Usage Monitor</h1>
  <h2 id = "time"></h2>
  <ul id = "apps">
    <li>hi</li>
  </ul>



  <script>
    const { ipcRenderer } = require('electron');

    function requestActiveApps() {
      if (running) {
        ipcRenderer.send('check-background-apps', interval, timeCounter, maxTime);
      }
    }

    ipcRenderer.on('app-list', (event, response) => {
      var apps = document.getElementById('apps');
      var item = document.createElement('li');
      item.textContent = response[0] + "\t\t\t\t\t\t\t\t" + response[1] + "\t\t\t\t\t\t\t\t" + response[3];
      apps.appendChild(item);
    });

    ipcRenderer.on('clear-list', (event) => {
      var apps = document.getElementById('apps');
      apps.innerHTML = "";
    });


    ipcRenderer.on('current-stats', (event, game) => {
      hasGame = game;
    });


    setInterval(() => {
      if (hasGame) {
        timeCounter -= 1;
        console.log(1);
        if (timeCounter == 0) {
          timeCounter = maxTime;
          hasGame = false;
          ipcRenderer.send('time-out');
          running = false;
        } 
      }
      var timeElement = document.getElementById('time');
      timeElement.innerHTML = timeCounter;
    }, 1000);
    
    requestActiveApps();
    setInterval(() => {
      requestActiveApps();
    }, interval*1000);
  </script>
</body>
</html>