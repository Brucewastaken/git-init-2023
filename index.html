<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>App Usage Monitor</title>
  <script>
    var interval = 60; //in seconds
    var timeCounter = 30;
    var maxTime = 30;
    var hasGame = false;
    var running = true;
  </script>
</head>
<style>
    h1{
      font-family: Helvetica;  
      font-size: 100px;
      color: white;
      text-align: center;
      outline:invert;
      outline-color: #9e363a;
      margin: 0;
      background-color: #1dbab4;
    }
    h2{
        color: blue; 
        font-size: 48px; 
        outline: auto;
        outline-color: aquamarine;
        width: 250px;
        margin: 10;
    }
    body{
        background-color: #1c77ac;
    }
    #apps{
        list-style-type: none;
        color: #1fd655;
        font-size: 40px;
        margin: 0;
    }
    #OnTask{
        position: absolute; 
        top: 50%; left: 50%; 
        transform: translate(-50%, -50%); 
        font-size: 100px; 
        color: #1fd655;
        margin: 0;
    }
    .settings{
        font-size: 48px;
        float: right;
        background-color: white;
        outline: auto;
        outline-color: aquamarine;
        margin: 0;
    }

</style>
<body>
  <h1>App Usage Monitor</h1>
  <h2 id = "time"></h2>
   

    <h2>Apps Used</h2>

    <ul id = "apps">
        <li>Minecraft</li>
        <li>Valorant</li>
    </ul>
    
    <text id="OnTask">ON TASK</text>

    <div class="settings">
        <label for="work_times">Choose a work time:</label>
            <select>
                <option value=10>10 minutes</option>
                <option value=15>15 minutes</option>
                <option value=20>20 minutes</option>
                <option value=30>30 minutes</option>
                <option value=45>45 minutes</option>
                <option value=60>1 hour</option>
            </select>
    </div>

  <script>
    const { ipcRenderer } = require('electron');

    function requestActiveApps() {
      if (running) {
        ipcRenderer.send('check-background-apps', interval, timeCounter, maxTime);
      }
    }

    ipcRenderer.on('app-list', (event, response) => {
      var apps = document.getElementById('apps');
      var item = document.createElement('li');
      item.textContent = response[0] + "\t\t\t\t\t\t\t\t" + response[1] + "\t\t\t\t\t\t\t\t" + response[3];
      apps.appendChild(item);
    });

    ipcRenderer.on('clear-list', (event) => {
      var apps = document.getElementById('apps');
      apps.innerHTML = "";
    });


    ipcRenderer.on('current-stats', (event, game) => {
      hasGame = game;
    });


    setInterval(() => {
      if (hasGame) {
        timeCounter -= 1;
        console.log(1);
        if (timeCounter == 0) {
          timeCounter = maxTime;
          hasGame = false;
          ipcRenderer.send('time-out');
          running = false;
        } 
      }
      var timeElement = document.getElementById('time');
      timeElement.innerHTML = timeCounter;
    }, 1000);
    
    requestActiveApps();
    setInterval(() => {
      requestActiveApps();
    }, interval*1000);
  </script>
</body>
</html>
